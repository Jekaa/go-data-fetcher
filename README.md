# Context-Aware Channel Pipeline

[![Go Version](https://img.shields.io/badge/Go-1.21+-blue)](https://golang.org/)

ะะตะฐะปะธะทะฐัะธั ะบะพะฝัะตะบััะฝะพ-ะทะฐะฒะธัะธะผะพะณะพ ะฟะฐะนะฟะปะฐะนะฝะฐ ะดะปั ะบะพะฝะบััะตะฝัะฝะพะน ะทะฐะณััะทะบะธ ะดะฐะฝะฝัั ั ะณะฐัะฐะฝัะธะตะน ะพััััััะฒะธั ััะตัะตะบ ะณะพัััะธะฝ ะธ ะบะพััะตะบัะฝะพะน ะพะฑัะฐะฑะพัะบะพะน ะพัะผะตะฝั ะพะฟะตัะฐัะธะน.

## ๐ฏ ะัะพะฑะตะฝะฝะพััะธ

- **ะะพะฝัะตะบััะฝะฐั ะพัะผะตะฝะฐ**: ะะณะฝะพะฒะตะฝะฝะฐั ะพััะฐะฝะพะฒะบะฐ ะฒัะตั ะณะพัััะธะฝ ะฟัะธ ะพัะผะตะฝะต ะบะพะฝัะตะบััะฐ
- **ะะตะท ััะตัะตะบ**: 100% ะณะฐัะฐะฝัะธั ะทะฐะฒะตััะตะฝะธั ะฒัะตั ะณะพัััะธะฝ
- **ะะพะฝะบััะตะฝัะฝะพััั**: ะะณัะฐะฝะธัะตะฝะธะต ะบะพะปะธัะตััะฒะฐ ะพะดะฝะพะฒัะตะผะตะฝะฝัั ะทะฐะณััะทะพะบ
- **Graceful Shutdown**: ะะพััะตะบัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ัะธะณะฝะฐะปะพะฒ ะฟัะตััะฒะฐะฝะธั
- **ะงะฐััะธัะฝัะต ัะตะทัะปััะฐัั**: ะะพะทะฒัะฐั ัะถะต ะฟะพะปััะตะฝะฝัั ะดะฐะฝะฝัั ะฟัะธ ะพัะผะตะฝะต
- **ะะดะธะพะผะฐัะธัะฝัะน Go**: ะกะปะตะดะพะฒะฐะฝะธะต ะปัััะธะผ ะฟัะฐะบัะธะบะฐะผ ัะทัะบะฐ

## ๐ ะัััััะน ััะฐัั

### ะฃััะฐะฝะพะฒะบะฐ

```bash
go get github.com/Jekaa/go-data-fetcher
```

### ะะฐะฟััะบ ะดะตะผะพ-ะฟัะธะปะพะถะตะฝะธั

```bash
# ะะฐะทะพะฒะฐั ะทะฐะณััะทะบะฐ ะฒัะตั URL
go run main.go

# ะะฐะณััะทะธัั ั ัะฐะนะผะฐััะพะผ 2 ัะตะบัะฝะดั
go run main.go -cancel-after=2s

# ะะพะปััะธัั ัะพะปัะบะพ 3 ัะตะทัะปััะฐัะฐ ะธ ะพัะผะตะฝะธัั
go run main.go -consume-only=3

# ะะณัะฐะฝะธัะธัั ะบะพะฝะบััะตะฝัะฝะพััั ะดะพ 2 ะทะฐะณััะทะพะบ
go run main.go -concurrency=2

# ะะพะฝะธัะพัะธะฝะณ ะณะพัััะธะฝ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
go run main.go -show-goroutines -cancel-after=3s

# ะะพะผะฑะธะฝะฐัะธั ะฟะฐัะฐะผะตััะพะฒ
go run main.go -concurrency=2 -consume-only=5 -show-goroutines
```

## ๐ ะััะธัะตะบัััะฐ

### ะะปััะตะฒัะต ะบะพะผะฟะพะฝะตะฝัั

```
โโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโ
โ    Fetch()      โโโโโโถโ      run()       โโโโโโถโ   fetchURL()    โ
โ  (ะฟัะฑะปะธัะฝัะน)    โ     โ  (ะบะพะพัะดะธะฝะฐัะพั)   โ     โ  (ะทะฐะณััะทัะธะบ)    โ
โโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโ
                               โ
                               โผ
                        โโโโโโโโโโโโโโโโโโโโ
                        โ  ะะฐะฝะฐะป ัะตะผะฐัะพัะฐ  โ
                        โ ะดะปั ะพะณัะฐะฝะธัะตะฝะธั  โ
                        โ  ะบะพะฝะบััะตะฝัะฝะพััะธ  โ
                        โโโโโโโโโโโโโโโโโโโโ
```

### ะะพัะพะบ ะดะฐะฝะฝัั

1. **Fetch()** ัะพะทะดะฐะตั ะฒััะพะดะฝะพะน ะบะฐะฝะฐะป ะธ ะทะฐะฟััะบะฐะตั ะบะพะพัะดะธะฝะฐัะพั
2. **run()** ัะฟัะฐะฒะปัะตั ะฟัะปะพะผ ะทะฐะณััะทัะธะบะพะฒ ะธ ัะตะผะฐัะพัะพะผ
3. **fetchURL()** ะฒัะฟะพะปะฝัะตั HTTP ะทะฐะฟัะพั ั ะบะพะฝัะตะบััะพะผ
4. ะะตะทัะปััะฐัั ะพัะฟัะฐะฒะปััััั ั ะฟัะพะฒะตัะบะพะน ะพัะผะตะฝั ัะตัะตะท `select`

### ะะพัะตะผั ัะฐะบ?

| ะะตัะตะฝะธะต | ะะปััะตัะฝะฐัะธะฒะฐ | ะัะตะธะผััะตััะฒะพ |
|---------|-------------|---------------|
| `select` ะฝะฐ ะพัะฟัะฐะฒะบั | ะััะผะฐั ะพัะฟัะฐะฒะบะฐ | ะะต ะฑะปะพะบะธััะตััั ะฟัะธ ะพัะผะตะฝะต |
| ะะดะธะฝัะน ะบะพะพัะดะธะฝะฐัะพั | ะะฐะบัััะธะต ัะตัะตะท `sync.Once` | ะัะพัะต ะดะพะบะฐะทะฐัั ะบะพััะตะบัะฝะพััั |
| ะะฐะฝะฐะป-ัะตะผะฐัะพั | `x/sync/semaphore` | ะะธะฝะธะผัะผ ะทะฐะฒะธัะธะผะพััะตะน |
| `defer close(out)` | ะฏะฒะฝะพะต ะทะฐะบัััะธะต | ะะฐัะฐะฝัะธั ะทะฐะบัััะธั |

## ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะะตััะธะบะธ

- **ะะฐะผััั**: ะะธะฝะธะผัะผ ะฐะปะปะพะบะฐัะธะน, ะพะฑัะตะบัั ัะพะทะดะฐัััั ะฝะฐ ััะตะบะต ะณะดะต ะฒะพะทะผะพะถะฝะพ
- **ะะพัััะธะฝั**: N + 2 (N ะทะฐะณััะทัะธะบะพะฒ + ะบะพะพัะดะธะฝะฐัะพั + ะผะพะฝะธัะพั)
- **ะะฐะดะตัะถะบะธ**: ะัะผะตะฝะฐ ะทะฐ < 1ms ะฟัะธ `ctx.Done()`

### ะกัะฐะฒะฝะตะฝะธะต ั ะฐะปััะตัะฝะฐัะธะฒะฐะผะธ

| ะะพะดัะพะด | ะฃัะตัะบะธ | ะกะปะพะถะฝะพััั | ะกะบะพัะพััั |
|--------|--------|-----------|----------|
| ะะฐั ะฟะฐะนะฟะปะฐะนะฝ | โ ะะตั | ะกัะตะดะฝัั | ๐ ะััะพะบะฐั |
| ะัะพััะพะน worker pool | โ ะััั | ะะธะทะบะฐั | ๐ฆ ะกัะตะดะฝัั |
| errgroup ะฑะตะท select | โ ะััั | ะกัะตะดะฝัั | ๐ฆ ะกัะตะดะฝัั |
| ะััะตัะธะทะธัะพะฒะฐะฝะฝัะน ะบะฐะฝะฐะป | โ๏ธ ะะฐะฒะธัะธั | ะกัะตะดะฝัั | ๐ ะััะพะบะฐั |

## ๐ ะขัะตะฑะพะฒะฐะฝะธั

- Go 1.21 ะธะปะธ ะฒััะต
- ะะฐะฒะธัะธะผะพััะธ: ัะพะปัะบะพ ััะฐะฝะดะฐััะฝะฐั ะฑะธะฑะปะธะพัะตะบะฐ

## ๐ ะะธัะตะฝะทะธั

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะผะฐัะตัะธะฐะปั

- [Go Concurrency Patterns: Pipelines and cancellation](https://go.dev/blog/pipelines)
- [Context documentation](https://pkg.go.dev/context)
- [Go memory model](https://go.dev/ref/mem)
```
